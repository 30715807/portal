<sql jt="dcMasterRJT">

    <!-- 查询用户信息 -->	
	<select id="queryuserreport" paging="true">
	     <![CDATA[
				//<#assign start='${start?default("0")}'>
				//<#assign limit='${limit?default("25")}'>
				//<#assign end=(start?number+limit?number)>
				//select * from(select <#if _DB_TYPE_="ORACLE">rownum<#else>ROW_NUMBER() over()</#if> as rn, 
					select t.* from operation_record t 
				//)a where a.rn>${start} and a.rn<=${end?c}
		 ]]>
	</select>
	<select id="queryuserreporttotal" class="int" first="true">
	     <![CDATA[
			 select count(*) 
			 from operation_record t 
		  ]]>
	</select>
	<select id="queryuserreportexcel" class="map">
	     <![CDATA[
select usermsg.*,usermsgzsl.* 
from 
(
select zc.value as yf,zc.temp as mbzcrs,zc.totaldata as zcrs,round(zc.totaldata/zc.temp,2) as wcl,round(smrz.totaldata/zc.totaldata,2) as smzhl,smrz.totaldata as smyh, 
round(bk.totaldata/smrz.totaldata,2) as bkzhl,bk.totaldata as bkyh,round(cztr.totaldata/bk.totaldata,2) as czzhl,cztr.totaldata as czyh, 
czbstr.totaldata as czbs,czcgbstr.totaldata as czcgbs 
from 

(select c.value,c.temp,md.totaldata from dc_config_code c left join 
(select count(1) as totaldata,substr(ua.inputtime,6,2) as mdata from user_account ua left join operation_record t on ua.userid=t.userid and t.handletype='1' where 1=1 
<#if yearparam?exists && yearparam!=''> and substr(ua.inputtime,1,4) = '${yearparam}' </#if> 
group by substr(ua.inputtime,6,2)) md 
on c.value = md.mdata where c.code='month' order by c.value asc ) zc 
, 
(select c.value,uamd.totaldata from dc_config_code c left join 
(select count(1) as totaldata,substr(ua.inputtime,6,2) as mdata from user_account ua left join user_authentication uath on ua.userid=uath.userid where uath.status='2' and ua.userauthflag='2' 
<#if yearparam?exists && yearparam!=''> and substr(ua.inputtime,1,4) = '${yearparam}' </#if>  
group by substr(ua.inputtime,6,2)) uamd on c.value = uamd.mdata where c.code='month' order by c.value asc) smrz 
, 
(select c.value,aimd.totaldata from dc_config_code c left join 
(select count(distinct ai.userid) as totaldata,substr(ai.inputtime,6,2) as mdata from account_info ai where 1=1 
<#if yearparam?exists && yearparam!=''> and substr(ai.inputtime,1,4) = '${yearparam}' </#if> 
group by substr(ai.inputtime,6,2)) aimd 
on c.value = aimd.mdata where c.code='month' order by c.value asc) bk 
, 
(select c.value,trmd.totaldata from dc_config_code c left join 
(select count(distinct tr.userid) as totaldata,substr(tr.inputtime,6,2) as mdata from transaction_record tr where 1=1 
<#if yearparam?exists && yearparam!=''> and substr(tr.inputtime,1,4) = '${yearparam}' </#if> 
and tr.transtype in ('1000','1012','1010','1011','1015','1016','1013','1050','1051','1070','1071','1100','6070','6071') 
group by substr(tr.inputtime,6,2)) trmd 
on c.value = trmd.mdata where c.code='month' order by c.value asc) cztr 
, 
(select c.value,trmd.totaldata from dc_config_code c left join 
(select count(1) as totaldata,substr(tr.inputtime,6,2) as mdata from transaction_record tr where 1=1 
<#if yearparam?exists && yearparam!=''> and substr(tr.inputtime,1,4) = '${yearparam}' </#if>  
and tr.transtype in ('1000','1012','1010','1011','1015','1016','1013','1050','1051','1070','1071','1100','6070','6071') 
group by substr(tr.inputtime,6,2)) trmd 
on c.value = trmd.mdata where c.code='month' order by c.value asc) czbstr 
, 
(select c.value,trmd.totaldata from dc_config_code c left join 
(select count(1) as totaldata,substr(tr.inputtime,6,2) as mdata from transaction_record tr where 1=1 
<#if yearparam?exists && yearparam!=''> and substr(tr.inputtime,1,4) = '${yearparam}' </#if> 
and tr.transtype in ('1000','1012','1010','1011','1015','1016','1013','1050','1051','1070','1071','1100','6070','6071') and tr.status='10'
group by substr(tr.inputtime,6,2)) trmd 
on c.value = trmd.mdata where c.code='month' order by c.value asc) czcgbstr 

where zc.value=smrz.value and zc.value=bk.value and zc.value=cztr.value and zc.value=czbstr.value and zc.value=czcgbstr.value
) usermsg , 
(
select 
sum(usermsgzs.mbzcrs) as mbzczs, 
sum(usermsgzs.zcrs) as zczs, 
round(sum(usermsgzs.zcrs/usermsgzs.mbzcrs)/12,2) as wcjz, 
round(sum(usermsgzs.smyh/usermsgzs.zcrs)/12,2) as zhjz, 
sum(usermsgzs.smyh) as smzs, 
round(sum(usermsgzs.bkyh/usermsgzs.smyh)/12,2) as bkjz, 
sum(usermsgzs.bkyh) as bkzs, 
round(sum(usermsgzs.czyh/usermsgzs.bkyh)/12,2) as czjz, 
sum(usermsgzs.czyh) as czzs,  
sum(usermsgzs.czbs) as czbszs,  
sum(usermsgzs.czcgbs) as czcgbszs 

from 
(
select zc.value as yf,zc.temp as mbzcrs,zc.totaldata as zcrs,round(zc.totaldata/zc.temp,2) as wcl,round(smrz.totaldata/zc.totaldata,2) as smzhl,smrz.totaldata as smyh, 
round(bk.totaldata/smrz.totaldata,2) as bkzhl,bk.totaldata as bkyh,round(cztr.totaldata/bk.totaldata,2) as czzhl,cztr.totaldata as czyh, 
czbstr.totaldata as czbs,czcgbstr.totaldata as czcgbs 
from 

(select c.value,c.temp,md.totaldata from dc_config_code c left join 
(select count(1) as totaldata,substr(ua.inputtime,6,2) as mdata from user_account ua left join operation_record t on ua.userid=t.userid and t.handletype='1' where 1=1 
<#if yearparam?exists && yearparam!=''> and substr(ua.inputtime,1,4) = '${yearparam}' </#if> 
group by substr(ua.inputtime,6,2)) md 
on c.value = md.mdata where c.code='month' order by c.value asc ) zc 
, 
(select c.value,uamd.totaldata from dc_config_code c left join 
(select count(1) as totaldata,substr(ua.inputtime,6,2) as mdata from user_account ua left join user_authentication uath on ua.userid=uath.userid where uath.status='2' and ua.userauthflag='2' 
<#if yearparam?exists && yearparam!=''> and substr(ua.inputtime,1,4) = '${yearparam}' </#if> 
group by substr(ua.inputtime,6,2)) uamd on c.value = uamd.mdata where c.code='month' order by c.value asc) smrz 
, 
(select c.value,aimd.totaldata from dc_config_code c left join 
(select count(distinct ai.userid) as totaldata,substr(ai.inputtime,6,2) as mdata from account_info ai where 1=1 
<#if yearparam?exists && yearparam!=''> and substr(ai.inputtime,1,4) = '${yearparam}' </#if> 
group by substr(ai.inputtime,6,2)) aimd 
on c.value = aimd.mdata where c.code='month' order by c.value asc) bk 
, 
(select c.value,trmd.totaldata from dc_config_code c left join 
(select count(distinct tr.userid) as totaldata,substr(tr.inputtime,6,2) as mdata from transaction_record tr where 1=1 
<#if yearparam?exists && yearparam!=''> and substr(tr.inputtime,1,4) = '${yearparam}' </#if> 
and tr.transtype in ('1000','1012','1010','1011','1015','1016','1013','1050','1051','1070','1071','1100','6070','6071') 
group by substr(tr.inputtime,6,2)) trmd 
on c.value = trmd.mdata where c.code='month' order by c.value asc) cztr 
, 
(select c.value,trmd.totaldata from dc_config_code c left join 
(select count(1) as totaldata,substr(tr.inputtime,6,2) as mdata from transaction_record tr where 1=1 
<#if yearparam?exists && yearparam!=''> and substr(tr.inputtime,1,4) = '${yearparam}' </#if> 
and tr.transtype in ('1000','1012','1010','1011','1015','1016','1013','1050','1051','1070','1071','1100','6070','6071') 
group by substr(tr.inputtime,6,2)) trmd 
on c.value = trmd.mdata where c.code='month' order by c.value asc) czbstr 
, 
(select c.value,trmd.totaldata from dc_config_code c left join 
(select count(1) as totaldata,substr(tr.inputtime,6,2) as mdata from transaction_record tr where 1=1 
<#if yearparam?exists && yearparam!=''> and substr(tr.inputtime,1,4) = '${yearparam}' </#if> 
and tr.transtype in ('1000','1012','1010','1011','1015','1016','1013','1050','1051','1070','1071','1100','6070','6071') and tr.status='10'
group by substr(tr.inputtime,6,2)) trmd 
on c.value = trmd.mdata where c.code='month' order by c.value asc) czcgbstr 

where zc.value=smrz.value and zc.value=bk.value and zc.value=cztr.value and zc.value=czbstr.value and zc.value=czcgbstr.value
) usermsgzs ) usermsgzsl
		 ]]>
	</select>
	<select id="queryuserreportchexcel" class="map">
	     <![CDATA[
select a.value as itemno, a.text as itemname, b.cnt,  
cn.accountcnt as nanaccountcnt,cnv.accountcnt as nvaccountcnt, nvl(cn.accountcnt,0)+nvl(cnv.accountcnt,0) as allaccountcnt, 
cn.amount as nanamount, cnv.amount as nvamount, nvl(cn.amount,0)+nvl(cnv.amount,0) as allamount, 
cnannew.amount as nannewamount, cnvnew.amount as nvnewamount, nvl(cnannew.amount,0)+nvl(cnvnew.amount,0) as newallamount, 
round(nvl(cn.amount,0)/nvl(cn.accountcnt,1),2) as nanrj, round(nvl(cnv.amount,0)/nvl(cnv.accountcnt,1),2) as nvrj, round((nvl(cn.amount,0)+nvl(cnv.amount,0))/(nvl(cn.accountcnt,1)+nvl(cnv.accountcnt,1)),2) as allrj 
from 
(select value,text, sortno from DC_CONFIG_CODE  where code='channel')a, 
(select channel,count(1) cnt from operation_record 
        where handletype='1'  
        <#if begandate?exists && begandate!=''> and inputtime >= '${begandate}' </#if> 
        <#if enddate?exists && enddate!=''> and inputtime <= '${enddate}' </#if> 
        group by channel)b, 
(SELECT channel, COUNT(1) accountcnt, sum(uir.amount) amount 
        FROM (select distinct o.indexid, o.handletype, o.channel,o.userid from operation_record o) opr, 
             user_invest_order uir,
             project_info p,
             user_account ua 
         WHERE uir.serialno=opr.indexid  and uir.status='20' and uir.projectid = p.serialno and p.status not in ('0', '1', '2') 
               and handletype = '2' and opr.userid=ua.userid and ua.certid is not null and mod(to_number(substr(ua.certid,17,1)),2)=0  GROUP BY channel
)cn, 
(SELECT channel, COUNT(1) accountcnt, sum(uir.amount) amount 
        FROM (select distinct o.indexid, o.handletype, o.channel,o.userid from operation_record o) opr, 
             user_invest_order uir,
             project_info p,
             user_account ua 
         WHERE uir.serialno=opr.indexid  and uir.status='20' and uir.projectid = p.serialno and p.status not in ('0', '1', '2') 
               and handletype = '2' and opr.userid=ua.userid and ua.certid is not null and mod(to_number(substr(ua.certid,17,1)),2)=1  GROUP BY channel
)cnv , 
(SELECT channel, COUNT(1) accountcnt, sum(uir.amount) amount 
        FROM (select distinct o.indexid, o.handletype, o.channel,o.userid from operation_record o) opr, 
             user_invest_order uir,
             project_info p,
             user_account ua 
         WHERE uir.serialno=opr.indexid  and uir.status='20' and uir.projectid = p.serialno and p.status not in ('0', '1', '2') 
               and handletype = '2'  
               <#if begandate?exists && begandate!=''> and uir.inputtime >= '${begandate}' </#if> 
        	   <#if enddate?exists && enddate!=''>  and uir.inputtime <= '${enddate}' </#if> 
               and opr.userid=ua.userid and ua.certid is not null and mod(to_number(substr(ua.certid,17,1)),2)=0  GROUP BY channel
)cnannew, 
(SELECT channel, COUNT(1) accountcnt, sum(uir.amount) amount 
        FROM (select distinct o.indexid, o.handletype, o.channel,o.userid from operation_record o) opr, 
             user_invest_order uir,
             project_info p,
             user_account ua 
         WHERE uir.serialno=opr.indexid  and uir.status='20' and uir.projectid = p.serialno and p.status not in ('0', '1', '2') 
               and handletype = '2'  
               <#if begandate?exists && begandate!=''> and uir.inputtime >= '${begandate}' </#if> 
        	   <#if enddate?exists && enddate!=''> and uir.inputtime <= '${enddate}' </#if> 
               and opr.userid=ua.userid and ua.certid is not null and mod(to_number(substr(ua.certid,17,1)),2)=1  GROUP BY channel
)cnvnew
where a.value = b.channel(+) AND  a.value = cn.channel(+) and a.value = cnv.channel(+) and a.value = cnannew.channel(+) and a.value = cnvnew.channel(+) order by a.sortno 
		 ]]>
	</select>
	<select id="queryuserreportageexcel" class="map">
	     <![CDATA[

select zco.ageregion as ageregion,zco.zccn as acozccn,smrznano.zccn as smrznanozccn,smrznvo.zccn as smrznvozccn, 
smrznano.zccn+smrznvo.zccn as smrznanoall, 
bknano.zccn as bknanozccn,bknvo.zccn as asbknvozccn, bknano.zccn+bknvo.zccn as bkzccnall,
cno.accountcnt as cnoaccountcnt,cnvo.accountcnt as cnvoaccountcnt, cno.accountcnt+cnvo.accountcnt as cncntall,
cno.amount as cnoamount,cnvo.amount as cnvoamount, cno.amount+cnvo.amount as cnamountall,
cnannewo.amount as cnannewoamount, cnvnewo.amount as cnvnewoamount, cnannewo.amount+cnvnewo.amount as cnnewamountall,
round(nvl(cno.amount,0)/nvl(NULLIF(cno.accountcnt,0),1),2) as nanrj,
round(nvl(cnvo.amount,0)/nvl(NULLIF(cnvo.accountcnt,0),1),2) as nvrj,
round((nvl(cno.amount,0)+nvl(cnvo.amount,0))/NULLIF((nvl(cno.accountcnt,1)+nvl(cnvo.accountcnt,1)),0),2) as allrj 
from  
(
    select dccode.text as ageregion,count(zci.userid) as zccn from DC_CONFIG_CODE dccode left join 
    (
    select ua.certid,oper.userid from operation_record oper, user_account ua 
            where ua.userid=oper.userid and oper.handletype='1' and length(ua.certid)=18
            <#if begandate?exists && begandate!=''> and oper.inputtime >= '${begandate}' </#if> 
        	<#if enddate?exists && enddate!=''> and oper.inputtime <= '${enddate}' </#if>
    ) zci on to_number(substr(dccode.value,1,3))<=(to_number(to_char(sysdate,'yyyy'))-to_number(substr(zci.certid,7,4))) 
             and (to_number(to_char(sysdate,'yyyy'))-to_number(substr(zci.certid,7,4))) <=to_number(substr(dccode.value,4,3)) 
             and REGEXP_LIKE(substr(zci.certid,7,4),'(^[+-]?\d{0,}\.?\d{0,}$)') 
     where dccode.code='ageregion' group by dccode.text,dccode.sortno order by dccode.sortno asc
) zco, 
(
     select dccode.text as ageregion,count(smrznani.certid) as zccn from DC_CONFIG_CODE dccode left join 
    (select uc.certid as certid from user_authentication ua,user_account uc 
            where ua.userid=uc.userid and ua.status='2' 
            and uc.certid is not null 
            and mod(to_number(substr(uc.certid,17,1)),2)=1
            and REGEXP_LIKE(substr(uc.certid,17,1),'(^[+-]?\d{0,}\.?\d{0,}$)')
    ) smrznani on to_number(substr(dccode.value,1,3))<=(to_number(to_char(sysdate,'yyyy'))-to_number(substr(smrznani.certid,7,4))) 
             and (to_number(to_char(sysdate,'yyyy'))-to_number(substr(smrznani.certid,7,4))) <=to_number(substr(dccode.value,4,3)) 
             and REGEXP_LIKE(substr(smrznani.certid,7,4),'(^[+-]?\d{0,}\.?\d{0,}$)') 
     where dccode.code='ageregion' group by dccode.text,dccode.sortno order by dccode.sortno asc 
) smrznano, 
(
     select dccode.text as ageregion,count(smrznvi.certid) as zccn from DC_CONFIG_CODE dccode left join 
    (select uc.certid as certid from user_authentication ua,user_account uc 
            where ua.userid=uc.userid and ua.status='2'  
            and uc.certid is not null 
            and mod(to_number(substr(uc.certid,17,1)),2)=0
            and REGEXP_LIKE(substr(uc.certid,17,1),'(^[+-]?\d{0,}\.?\d{0,}$)')
    ) smrznvi on to_number(substr(dccode.value,1,3))<=(to_number(to_char(sysdate,'yyyy'))-to_number(substr(smrznvi.certid,7,4))) 
             and (to_number(to_char(sysdate,'yyyy'))-to_number(substr(smrznvi.certid,7,4))) <=to_number(substr(dccode.value,4,3)) 
             and REGEXP_LIKE(substr(smrznvi.certid,7,4),'(^[+-]?\d{0,}\.?\d{0,}$)') 
     where dccode.code='ageregion' group by dccode.text,dccode.sortno order by dccode.sortno asc 
) smrznvo, 
(
     select dccode.text as ageregion,count(bknani.certid) as zccn from DC_CONFIG_CODE dccode left join 
    (select distinct uc.certid as certid from account_info ai,user_account uc
           where ai.userid=uc.userid 
           and uc.certid is not null 
           and ai.status='2'
           and mod(to_number(substr(uc.certid,17,1)),2)=1
           and REGEXP_LIKE(substr(uc.certid,17,1),'(^[+-]?\d{0,}\.?\d{0,}$)')
    ) bknani on to_number(substr(dccode.value,1,3))<=(to_number(to_char(sysdate,'yyyy'))-to_number(substr(bknani.certid,7,4))) 
             and (to_number(to_char(sysdate,'yyyy'))-to_number(substr(bknani.certid,7,4))) <=to_number(substr(dccode.value,4,3)) 
             and REGEXP_LIKE(substr(bknani.certid,7,4),'(^[+-]?\d{0,}\.?\d{0,}$)') 
     where dccode.code='ageregion' group by dccode.text,dccode.sortno order by dccode.sortno asc    
) bknano, 
(
     select dccode.text as ageregion,count(bknvi.certid) as zccn from DC_CONFIG_CODE dccode left join 
    (select distinct uc.certid as certid from account_info ai,user_account uc
           where ai.userid=uc.userid 
           and uc.certid is not null 
           and ai.status='2'
           and mod(to_number(substr(uc.certid,17,1)),2)=0
           and REGEXP_LIKE(substr(uc.certid,17,1),'(^[+-]?\d{0,}\.?\d{0,}$)')
    ) bknvi on to_number(substr(dccode.value,1,3))<=(to_number(to_char(sysdate,'yyyy'))-to_number(substr(bknvi.certid,7,4))) 
             and (to_number(to_char(sysdate,'yyyy'))-to_number(substr(bknvi.certid,7,4))) <=to_number(substr(dccode.value,4,3)) 
             and REGEXP_LIKE(substr(bknvi.certid,7,4),'(^[+-]?\d{0,}\.?\d{0,}$)') 
     where dccode.code='ageregion' group by dccode.text,dccode.sortno order by dccode.sortno asc 
) bknvo, 
(
     select dccode.text as ageregion,count(distinct cni.certid) as accountcnt,sum(cni.amount) amount  from DC_CONFIG_CODE dccode left join 
    (SELECT uir.amount as amount,ua.certid as certid
            FROM (select distinct o.indexid, o.handletype, o.channel,o.userid from operation_record o) opr, 
                 user_invest_order uir,
                 project_info p,
                 user_account ua 
             WHERE uir.serialno=opr.indexid  and uir.status='20' and uir.projectid = p.serialno and p.status not in ('0', '1', '2') 
             and handletype = '2' 
             and opr.userid=ua.userid 
             and ua.certid is not null 
             and mod(to_number(substr(ua.certid,17,1)),2)=1 
             and REGEXP_LIKE(substr(ua.certid,17,1),'(^[+-]?\d{0,}\.?\d{0,}$)')
    )cni on to_number(substr(dccode.value,1,3))<=(to_number(to_char(sysdate,'yyyy'))-to_number(substr(cni.certid,7,4))) 
             and (to_number(to_char(sysdate,'yyyy'))-to_number(substr(cni.certid,7,4))) <=to_number(substr(dccode.value,4,3)) 
             and REGEXP_LIKE(substr(cni.certid,7,4),'(^[+-]?\d{0,}\.?\d{0,}$)') 
     where dccode.code='ageregion' group by dccode.text,dccode.sortno order by dccode.sortno asc  
) cno, 
(
     select dccode.text as ageregion,count(distinct cnvi.certid) as accountcnt,sum(cnvi.amount) amount  from DC_CONFIG_CODE dccode left join
    (SELECT uir.amount as amount,ua.certid as certid 
            FROM (select distinct o.indexid, o.handletype, o.channel,o.userid from operation_record o) opr, 
                 user_invest_order uir,
                 project_info p,
                 user_account ua 
             WHERE uir.serialno=opr.indexid  and uir.status='20' and uir.projectid = p.serialno and p.status not in ('0', '1', '2') 
             and handletype = '2' 
             and opr.userid=ua.userid 
             and ua.certid is not null 
             and mod(to_number(substr(ua.certid,17,1)),2)=0 
             and REGEXP_LIKE(substr(ua.certid,17,1),'(^[+-]?\d{0,}\.?\d{0,}$)')
    )cnvi on to_number(substr(dccode.value,1,3))<=(to_number(to_char(sysdate,'yyyy'))-to_number(substr(cnvi.certid,7,4))) 
                 and (to_number(to_char(sysdate,'yyyy'))-to_number(substr(cnvi.certid,7,4))) <=to_number(substr(dccode.value,4,3)) 
                 and REGEXP_LIKE(substr(cnvi.certid,7,4),'(^[+-]?\d{0,}\.?\d{0,}$)')
         where dccode.code='ageregion' group by dccode.text,dccode.sortno order by dccode.sortno asc  
)cnvo, 
(
    select dccode.text as ageregion,count(distinct cnannewi.certid) as accountcnt,sum(cnannewi.amount) amount  from DC_CONFIG_CODE dccode left join
    (SELECT uir.amount as amount,ua.certid as certid 
            FROM (select distinct o.indexid, o.handletype, o.channel,o.userid from operation_record o) opr, 
                 user_invest_order uir,
                 project_info p,
                 user_account ua 
             WHERE uir.serialno=opr.indexid  and uir.status='20' and uir.projectid = p.serialno and p.status not in ('0', '1', '2') 
             and handletype = '2' 
             <#if begandate?exists && begandate!=''> and uir.inputtime >= '${begandate}' </#if> 
        	 <#if enddate?exists && enddate!=''> and uir.inputtime <= '${enddate}' </#if> 
             and opr.userid=ua.userid 
             and ua.certid is not null 
             and mod(to_number(substr(ua.certid,17,1)),2)=1 
             and REGEXP_LIKE(substr(ua.certid,17,1),'(^[+-]?\d{0,}\.?\d{0,}$)')
    )cnannewi on to_number(substr(dccode.value,1,3))<=(to_number(to_char(sysdate,'yyyy'))-to_number(substr(cnannewi.certid,7,4))) 
                 and (to_number(to_char(sysdate,'yyyy'))-to_number(substr(cnannewi.certid,7,4))) <=to_number(substr(dccode.value,4,3)) 
                 and REGEXP_LIKE(substr(cnannewi.certid,7,4),'(^[+-]?\d{0,}\.?\d{0,}$)')
         where dccode.code='ageregion' group by dccode.text,dccode.sortno order by dccode.sortno asc 
)cnannewo, 
(
     select dccode.text as ageregion,count(distinct cnvnew.certid) as accountcnt,sum(cnvnew.amount) amount  from DC_CONFIG_CODE dccode left join 
    (SELECT uir.amount as amount,ua.certid as certid 
            FROM (select distinct o.indexid, o.handletype, o.channel,o.userid from operation_record o) opr, 
                 user_invest_order uir,
                 project_info p,
                 user_account ua 
             WHERE uir.serialno=opr.indexid  and uir.status='20' and uir.projectid = p.serialno and p.status not in ('0', '1', '2') 
             and handletype = '2' 
             <#if begandate?exists && begandate!=''> and uir.inputtime >= '${begandate}' </#if> 
        	 <#if enddate?exists && enddate!=''> and uir.inputtime <= '${enddate}' </#if> 
             and opr.userid=ua.userid 
             and ua.certid is not null 
             and mod(to_number(substr(ua.certid,17,1)),2)=0  
             and REGEXP_LIKE(substr(ua.certid,17,1),'(^[+-]?\d{0,}\.?\d{0,}$)')
    )cnvnew on to_number(substr(dccode.value,1,3))<=(to_number(to_char(sysdate,'yyyy'))-to_number(substr(cnvnew.certid,7,4))) 
                 and (to_number(to_char(sysdate,'yyyy'))-to_number(substr(cnvnew.certid,7,4))) <=to_number(substr(dccode.value,4,3)) 
                 and REGEXP_LIKE(substr(cnvnew.certid,7,4),'(^[+-]?\d{0,}\.?\d{0,}$)')
         where dccode.code='ageregion' group by dccode.text,dccode.sortno order by dccode.sortno asc  
)cnvnewo 
where zco.ageregion=smrznano.ageregion and zco.ageregion=smrznvo.ageregion and zco.ageregion=bknano.ageregion 
and zco.ageregion=bknvo.ageregion and zco.ageregion=cno.ageregion and  zco.ageregion=cnvo.ageregion 
and zco.ageregion=cnannewo.ageregion and  zco.ageregion=cnvnewo.ageregion
		 ]]>
	</select>
	<select id="queryprojectdealreportexcel" class="map">
	     <![CDATA[
select item.value,item.temp,round(item.dealamount/10000,2) as dealamount,round((item.dealamount/10000)/item.temp,2) as yddbl,total.mbzj,round(total.dealamounttotal/10000,2) as dealamounttotal,total.yddbzj from 
(
select c.value,c.temp,pideal.dealamount from dc_config_code c left join 
(
select substr(pi.dealtime,6,2) as yf,sum(pi.LOANAMOUNT-pi.remainamount) as dealamount from PROJECT_INFO pi where 1=1 
<#if yearparam?exists && yearparam!=''> and substr(pi.dealtime,1,4)='${yearparam}' </#if> 
group by substr(pi.dealtime,6,2)
) pideal 
on c.value = pideal.yf where c.code='monthpd' order by c.value asc 
) item ,
(
select sum(itemtotal.temp) as mbzj,sum(itemtotal.dealamount) as dealamounttotal,round(sum((itemtotal.dealamount/10000)/itemtotal.temp)/12,2) as yddbzj from  
(
select c.value,c.temp,pideal.dealamount from dc_config_code c left join 
(
select substr(pi.dealtime,6,2) as yf,sum(pi.LOANAMOUNT-pi.remainamount) as dealamount from PROJECT_INFO pi where 1=1 
<#if yearparam?exists && yearparam!=''> and substr(pi.dealtime,1,4)='${yearparam}' </#if> 
group by substr(pi.dealtime,6,2)
) pideal 
on c.value = pideal.yf where c.code='monthpd' order by c.value asc 
) itemtotal 
) total 
		 ]]>
	</select>
	<select id="queryprojectdealprodexcel" class="map">
	     <![CDATA[
select newp.text,newp.newnum,newp.newdealamount,endp.dqnum,endp.yhbj,endp.yhlx from 
(
select c.text,newproj.newnum,newproj.newdealamount from dc_config_code c left join 
(
select pi.producttype as prodtype, count(pi.serialno) as newnum,sum(pi.loanamount) as newdealamount from PROJECT_INFO pi 
       where 1=1 
       <#if begandate?exists && begandate!=''> and pi.BEGINDATE>='${begandate}' </#if> 
       <#if enddate?exists && enddate!=''> and pi.BEGINDATE<='${enddate}' </#if> 
       group by pi.producttype 
) newproj 
on c.value = newproj.prodtype where c.code='prodtype' order by c.sortno asc 
) newp
,
(
select c.text,endproj.dqnum,endproj.yhbj,endproj.yhlx from dc_config_code c left join 
(
select pi.producttype as prodtype, count(pi.serialno) as dqnum,sum(aps.PAYCORPUSAMT) as yhbj,sum(aps.PAYINTEAMT) as yhlx  
       from project_info pi,ACCT_LOAN al,ACCT_PAYMENT_SCHEDULE aps 
       where pi.serialno=al.clearanceacctno and al.serialno=aps.objectno 
       <#if begandate?exists && begandate!=''> and pi.PROJECTENDDATE>='${begandate}' </#if> 
       <#if enddate?exists && enddate!=''> and pi.PROJECTENDDATE<='${enddate}' </#if> 
       group by pi.producttype 
) endproj 
on c.value = endproj.prodtype where c.code='prodtype' order by c.sortno asc
) endp 
where newp.text=endp.text
		 ]]>
	</select>
	<select id="queryprojectdealrateexcel" class="map">
	     <![CDATA[
select pi.loanterm,pi.loanrate,count(pi.serialno) as projnum,sum(pi.loanamount) as dealamount 
       from PROJECT_INFO pi 
       where 1=1 
       <#if begandate?exists && begandate!=''> and pi.DEALTIME>='${begandate}' </#if> 
       <#if enddate?exists && enddate!=''> and pi.DEALTIME<='${enddate}' </#if> 
       group by pi.loanterm,pi.loanrate order by pi.loanterm,pi.loanrate
		 ]]>
	</select>
	<select id="queryprojectdealchexcel" class="map">
	     <![CDATA[
select proitem.text,nvl(round(proitem.projamount/10000,2),0) as projamount,nvl(total.projtotal,0) as projtotal,round(total.projamtotal/10000,2) as projamtotal from 
(
select a.subitemname as text,c.amount as projamount 
from 
(
	select subitemno, subitemname, sortno from SUB_CODE_LIBRARY  where isinuse='1' and subcodeno = 'UserChannel'
)a,
(
	SELECT channel, COUNT(1) accountcnt, sum(uir.amount) amount FROM 
		(select distinct o.indexid, o.handletype, o.channel from operation_record o)opr,
		user_invest_order uir,
		project_info p 
	WHERE uir.serialno=opr.indexid  
				and uir.status='20' 
				and uir.projectid = p.serialno 
				and p.status not in ('0', '1', '2') 
				<#if begandate?exists && begandate!=''> and p.begindate>='${begandate}' </#if> 
				<#if enddate?exists && enddate!=''> and p.begindate<='${enddate}' </#if>  
				and handletype = '2' GROUP BY channel 
)c 
where a.subitemno = c.channel(+) order by a.sortno
) proitem, 
(
select sum(itemtotal.accountcnt) as projtotal,sum(itemtotal.amount) as projamtotal from 
(
SELECT channel, COUNT(1) accountcnt, sum(uir.amount) amount FROM 
		(select distinct o.indexid, o.handletype, o.channel from operation_record o)opr,
		user_invest_order uir,
		project_info p 
	WHERE uir.serialno=opr.indexid  
				and uir.status='20' 
				and uir.projectid = p.serialno 
				and p.status not in ('0', '1', '2') 
        		<#if begandate?exists && begandate!=''> and p.begindate>='${begandate}' </#if> 
				<#if enddate?exists && enddate!=''> and p.begindate<='${enddate}' </#if> 
				and handletype = '2' GROUP BY channel
) itemtotal
) total
		 ]]>
	</select>
	<select id="queryrechargewithdrawexcel" class="map">
	     <![CDATA[
select COALESCE(cz.czdate,tx.txdate) as cztxdate,cz.czyhs,cz.czzje,round(czzje/czyhs,2) as rjczje,tx.txyhs,tx.txzje from 
(
select substr(tr.inputtime,1,10) as czdate,count(distinct tr.userid) as czyhs,sum(tr.amount) as czzje  
from transaction_record tr 
where tr.transtype in ('1000','1012','1010','1011','1015','1016','1013','1050','1051','1070','1071','1100','6070','6071') 
group by substr(tr.inputtime,1,10) 
) cz 
full join  
(
select substr(tr.inputtime,1,10) as txdate,count(distinct tr.userid) as txyhs,sum(tr.amount) as txzje  
from transaction_record tr 
where tr.transtype in ('1001','1020','1021','1024','1025','1026','1027') 
group by substr(tr.inputtime,1,10) 
) tx 
on cz.czdate=tx.txdate 
where 1=1 
<#if begandate?exists && begandate!=''> and COALESCE(cz.czdate,tx.txdate) >='${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and COALESCE(cz.czdate,tx.txdate) <='${enddate}' </#if> 
order by cztxdate desc
		 ]]>
	</select>
	<select id="queryprojectpendpayexcel" class="map">
	     <![CDATA[
select aps.paydate,count(pi.serialno) as projnum,sum(aps.PAYCORPUSAMT) as yhbj, sum(aps.PAYINTEAMT) as yhlx 
       from project_info pi,ACCT_LOAN al,ACCT_PAYMENT_SCHEDULE aps 
       where pi.serialno=al.clearanceacctno and al.serialno=aps.objectno 
       <#if begandate?exists && begandate!=''> and aps.PAYDATE>='${begandate}' </#if> 
	   <#if enddate?exists && enddate!=''> and aps.PAYDATE<='${enddate}' </#if> 
       group by aps.PAYDATE order by aps.PAYDATE asc
		 ]]>
	</select>
	<select id="queryextinformationexcel" class="map">
	     <![CDATA[
select brhxt.xdprojectno,brhxt.projectname,brhxt.LoanAmount,
(brhxt.loanamount-brhxt.remainamount) as realLoanAmount,brhxt.LoanTerm || decode(brhxt.loantermflag, '010', '天', ' 030', '年', '个月') AS LoanTerm,brhxt.enddate,
xscust.customername,xscust.certid,(select distinct bl.bankname from bank_library bl where bl.bankcode=xscust.accountbelong and rownum = 1) as bankname,
xscust.accountno,xsxt.orgname
from 
( select la.xdprojectno,pi.projectname,pi.LoanAmount,pi.remainamount,pi.LoanTerm,pi.loantermflag,pi.enddate from 
project_info pi,
business_approve ba,
loan_apply la where 1=1 
and pi.loanapplyno=ba.serialno 
and pi.status<>'2'  
and la.fundsource='XD' 
and ba.relativeserialno=la.applyno 
<#if begandate?exists && begandate!=''> and pi.enddate>='${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and pi.enddate<='${enddate}' </#if>  
and la.xdprojectno is not null 
and la.productid in ('D0001C','D0002C','D0003C','D0016C','D0017C','D0018C') 
) brhxt left join 
( select XSOI.orgname,XSPR.PROJECTNO,XSBA.BUSINESSMANAGER from 
XS_PROJECT_RELATIVE_ASSESTS XSPR ,XS_UNDERLY_ASSETS XSUA , XS_BUSINESS_APPLY XSBA ,XS_ORG_INFO XSOI 
where XSBA.SERIALNO = XSUA.APPROVENO and XSUA.ASSETNO =XSPR.OBJECTNO and XSBA.BUSINESSORG = XSOI.ORGID 
) xsxt on brhxt.xdprojectno=xsxt.PROJECTNO left join 
(
  select XSCI.CUSTOMERID,XSCI.customername,XSCI.certid,XSCI.FINANCIERNO,custfirst.accountbelong,custfirst.accountno from XS_CUSTOMER_INFO XSCI,
  (
  select accountbelong,accountno,userid 
  from (select emp.*,row_number() over(partition by emp.userid order by rownum) cn from 
  (
  select * from account_info ai where ai.status='2' 
  ) emp )
  where cn = 1 
  ) custfirst where custfirst.userid=XSCI.FINANCIERNO
) xscust on xsxt.BUSINESSMANAGER = xscust.CUSTOMERID
where 1=1 
and xsxt.orgname is not null 
order by brhxt.enddate
		 ]]>
	</select>

	<!-- 注册-投资统计表 -->
		<select id="queryreginvestsummary" class="map">
	     <![CDATA[
select to_char(nvl(dealamount.amount/10000,0),'9999999990.99') as amount,firstregist.num as registnum,firstinvest.num as investnum from 
(
select sum(ir.amount) as amount 
from invest_record ir,operation_record o,user_contract uc,project_info pi 
where 1=1 
and ir.relativeuioserialno=o.indexid 
and o.handletype = '2' 
and ir.userid=uc.userid 
and ir.rebillno=uc.contractid 
and ir.subcontractno = uc.subcontractno 
and pi.status not in ('0', '1', '2') 
and uc.projectid=pi.serialno 
<#if begandate?exists && begandate!=''> and substr(ir.inputtime,0,10)  >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and substr(ir.inputtime,0,10)  <= '${enddate}'</#if>  

) dealamount,
(
select count(1) as num from operation_record o where o.handletype = '1'  
<#if begandate?exists && begandate!=''> and substr(o.inputtime,0,10) >=  '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and substr(o.inputtime,0,10) <= '${enddate}'</#if>  
) firstregist,
(
select count(1) as num from invest_record ir,  
(select i.userid,min(i.inputtime) time from invest_record i group by i.userid having 1=1 
<#if begandate?exists && begandate!=''> and substr(min(i.inputtime),0,10）  >=  '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and substr(min(i.inputtime),0,10）  <= '${enddate}'</#if> 

)a,operation_record o 
where 1=1 
and ir.userid=a.userid and ir.inputtime=a.time 
and ir.relativeuioserialno=o.indexid 
and o.handletype = '2'
) firstinvest
		 ]]>
	</select>	
	
	
	<!-- 注册-投资明细统计表 -->
		<select id="queryregreginvestdetail" class="map">
	     <![CDATA[
select dataorder.inputtime,dataorder.amount,dataorder.registnum,dataorder.investnum from
(
select COALESCE(dealamount.inputtime,firstregist.inputtime,firstinvest.inputtime,'') as inputtime,to_char(nvl(dealamount.amount/10000,0),'9999999990.99') as amount,firstregist.num as registnum,firstinvest.num as investnum from 
(
select substr(ir.inputtime,0,10) as inputtime,sum(ir.amount) as amount  
from invest_record ir,operation_record o,user_contract uc,project_info pi 
where 1=1 
and ir.relativeuioserialno=o.indexid 
and o.handletype = '2' 
and ir.userid=uc.userid 
and ir.rebillno=uc.contractid 
and ir.subcontractno = uc.subcontractno 
and pi.status not in ('0', '1', '2') 
and uc.projectid=pi.serialno 
<#if begandate?exists && begandate!=''> and substr(ir.inputtime,0,10)  >= '${begandate}' </#if>   
<#if enddate?exists && enddate!=''> and substr(ir.inputtime,0,10)  <= '${enddate}'</#if>  
group by substr(ir.inputtime,0,10) order by substr(ir.inputtime,0,10) 
) dealamount full join 
(
select substr(o.inputtime,0,10) as inputtime,count(1) as num from operation_record o where o.handletype = '1'  
<#if begandate?exists && begandate!=''> and substr(o.inputtime,0,10) >=  '${begandate}' </#if>  
<#if enddate?exists && enddate!=''> and substr(o.inputtime,0,10) <= '${enddate}'</#if>  
group by substr(o.inputtime,0,10) order by substr(o.inputtime,0,10) 
) firstregist on dealamount.inputtime = firstregist.inputtime full join
(
select substr(ir.inputtime,0,10) as inputtime,count(1) as num from invest_record ir,  
(select i.userid,min(i.inputtime) time from invest_record i group by i.userid having 1=1 
<#if begandate?exists && begandate!=''> and substr(min(i.inputtime),0,10）  >=  '${begandate}' </#if>   
<#if enddate?exists && enddate!=''> and substr(min(i.inputtime),0,10）  <= '${enddate}'</#if> 
)a,operation_record o 
where 1=1 
and ir.userid=a.userid and ir.inputtime=a.time 
and ir.relativeuioserialno=o.indexid 
and o.handletype = '2' 
group by substr(ir.inputtime,0,10) order by substr(ir.inputtime,0,10) 
) firstinvest on firstregist.inputtime = firstinvest.inputtime
) dataorder order by dataorder.inputtime
		 ]]>
	</select>	
	
	
		<select id="queryreginvestotal" class="map">
	     <![CDATA[
select to_char(sum(nvl(dataorder.amount/10000,0)),'9999999990.99') as amount,sum(dataorder.registnum) as registnum,sum(dataorder.investnum) as investnum from
(
select COALESCE(dealamount.inputtime,firstregist.inputtime,firstinvest.inputtime,'') as inputtime,dealamount.amount as amount,firstregist.num as registnum,firstinvest.num as investnum from 
(
select substr(ir.inputtime,0,10) as inputtime,sum(ir.amount) as amount  
from invest_record ir,operation_record o,user_contract uc,project_info pi 
where 1=1 
and ir.relativeuioserialno=o.indexid 
and o.handletype = '2' 
and ir.userid=uc.userid 
and ir.rebillno=uc.contractid 
and ir.subcontractno = uc.subcontractno 
and pi.status not in ('0', '1', '2') 
and uc.projectid=pi.serialno 
<#if begandate?exists && begandate!=''> and substr(ir.inputtime,0,10)  >= '${begandate}' </#if>  
<#if enddate?exists && enddate!=''> and substr(ir.inputtime,0,10)  <= '${enddate}'</#if>  
group by substr(ir.inputtime,0,10) order by substr(ir.inputtime,0,10) 
) dealamount full join 
(
select substr(o.inputtime,0,10) as inputtime,count(1) as num from operation_record o where o.handletype = '1'  
<#if begandate?exists && begandate!=''> and substr(o.inputtime,0,10) >=  '${begandate}' </#if>  
<#if enddate?exists && enddate!=''> and substr(o.inputtime,0,10) <= '${enddate}'</#if>  
group by substr(o.inputtime,0,10) order by substr(o.inputtime,0,10) 
) firstregist on dealamount.inputtime = firstregist.inputtime full join
(
select substr(ir.inputtime,0,10) as inputtime,count(1) as num from invest_record ir,  
(select i.userid,min(i.inputtime) time from invest_record i group by i.userid having 1=1 
<#if begandate?exists && begandate!=''> and substr(min(i.inputtime),0,10）  >=   '${begandate}' </#if>   
<#if enddate?exists && enddate!=''> and substr(min(i.inputtime),0,10）  <= '${enddate}'</#if>
)a,operation_record o 
where 1=1 
and ir.userid=a.userid and ir.inputtime=a.time 
and ir.relativeuioserialno=o.indexid 
and o.handletype = '2' 
group by substr(ir.inputtime,0,10) order by substr(ir.inputtime,0,10) 
) firstinvest on firstregist.inputtime = firstinvest.inputtime
) dataorder order by dataorder.inputtime
		 ]]>
	</select>	
	
	
	
	
	<select id="querymarketdatadayexcel" class="map">
	     <![CDATA[
select 
ua.phonetel, 
substr(oo.inputtime,1,10) as inputtime, 
nvl((select scl.subitemname as text from SUB_CODE_LIBRARY scl where scl.subcodeno='UserChannel' and scl.subitemno=nvl(oo.channel,'BRH_WEB')),'邦融汇网站') as channel, 
case when nvl(uath.status,0)='2' then '已认证' else '未认证' end as rzzt, 
substr(invest.inputtime,1,10) as irinputtime, 
invest.projectname, 
invest.amount, 
case when (invest.inputtime is null) then null else (select cl.itemname from CODE_LIBRARY cl where cl.codeno='PlatformType' and cl.itemno=nvl(invest.usageplatform,0)) end as investChannel  
from user_account ua left join user_authentication uath on ua.userid=uath.userid left join 
(
select uc.userid,irfirst.inputtime,irfirst.amount,irfirst.usageplatform,abd.productdes as projectname from 
user_contract uc,project_info pi,business_approve ba,acct_business_define abd,  
(
select userid,inputtime,rebillno,amount,usageplatform 
from (select emp.*,row_number() over(partition by emp.userid order by rownum) cn from 
(
select * from invest_record order by userid,inputtime asc
) emp )
where cn = 1 
) irfirst where 1=1 
and irfirst.userid=uc.userid 
and irfirst.rebillno=uc.contractid 
and uc.projectid=pi.serialno 
and pi.loanapplyno=ba.serialno 
and ba.businesstype=abd.typeno 
) invest on invest.userid=ua.userid, 
operation_record oo 
where 1=1 
and oo.userid=ua.userid 
and oo.handleurl='register/finish'  
<#if begandate?exists && begandate!=''> and substr(oo.inputtime,1,10) >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and substr(oo.inputtime,1,10) <= '${enddate}' </#if> 
order by oo.inputtime desc
		 ]]>
	</select>	
	<select id="querybaoxianrenexcel" class="map">
	     <![CDATA[
select 
pi.serialno,
tzr.realname as beibaoren,
tzr.certid,
tzr.username,
tzr.phonetel,
userinfo.accountno,
(select distinct bl.bankname from bank_library bl where bl.bankcode=userinfo.accountbelong and rownum = 1) as bankname, 
'是' as iscon,
tzr.contractid,
pi.enddate,
pi.projectname,
tzr.amount,
tzrhkjh.payinteamt, 
tzrhkjh.loanrate,
jkr.realname,
(to_date(tzr.maturitydate,'YYYY/MM/DD')-to_date(tzrhkjh.intedate,'YYYY/MM/DD')+1) as bxqx,
(tzrhkjh.paycorpusamt+tzrhkjh.payinteamt) as bxj 
from project_info pi,business_approve ba,loan_apply la, 
( 
  select al.serialno,ua.userid,ua.realname,ua.certid,ua.username,ua.phonetel,csr.subcontractno as contractid,uc.investsum as amount,al.maturitydate,al.clearanceacctno,uc.projectid 
  from user_account2 ua,acct_loan al,user_contract uc left join contract_s_record csr on uc.subcontractno=csr.contractno and csr.subcontractno like '%JK%'  
  where 1=1 
  and al.customerid=ua.userid 
  and ua.userid=uc.userid 
  and al.objecttype = '02' 
  
) tzr,
(
  select aps.objectno,sum(aps.payinteamt) as payinteamt,aps.loanrate,min(aps.intedate) as intedate,sum(aps.paycorpusamt) as paycorpusamt from acct_payment_schedule aps 
  where 1=1 group by aps.loanrate,aps.objectno 
) tzrhkjh,
(
  select accountbelong,accountno,userid 
  from (select emp.*,row_number() over(partition by emp.userid order by rownum) cn from 
  (
  select * from account_info ai where ai.status='2' 
  ) emp )
  where cn = 1 
) userinfo,
(
  select ua2.realname,al2.clearanceacctno  
  from acct_loan al2,user_account2 ua2 where 1=1 
  and al2.objecttype='01' 
  and al2.customerid=ua2.userid 
) jkr 
where 1=1 
and pi.loanapplyno=ba.serialno 
and ba.relativeserialno = la.applyno 
and pi.status not in ('0', '1', '2') 
and pi.serialno = tzr.clearanceacctno 
and tzr.userid = userinfo.userid(+) 
and tzr.projectid=pi.serialno 
and pi.serialno = jkr.clearanceacctno 
and pi.enddate is not null 
and tzrhkjh.objectno=tzr.serialno 
<#if xmbh?exists && xmbh=='ok'> and 1=2 </#if>
<#if xmbh?exists && xmbh!=''> and pi.serialno='${xmbh}' </#if> 
<#if toubaoperson?exists && toubaoperson!=''> and jkr.realname='${toubaoperson}' </#if> 
<#if begandate?exists && begandate!=''> and substr(pi.enddate,1,10) >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and substr(pi.enddate,1,10) <= '${enddate}' </#if> 
<#if proname?exists && proname!=''> and pi.projectname like '%${proname}%' </#if> 
		 ]]>
	</select>
	<select id="querybaoxianrencountexcel" class="map">
	     <![CDATA[
select 
count(distinct pi.projectname) as num
from project_info pi,business_approve ba,loan_apply la, 
( 
  select al.serialno,ua.userid,ua.realname,ua.certid,ua.username,ua.phonetel,csr.subcontractno as contractid,uc.investsum as amount,al.maturitydate,al.clearanceacctno,uc.projectid 
  from user_account2 ua,acct_loan al,user_contract uc left join contract_s_record csr on uc.subcontractno=csr.contractno and csr.subcontractno like '%JK%'  
  where 1=1 
  and al.customerid=ua.userid 
  and ua.userid=uc.userid 
  and al.objecttype = '02' 
  
) tzr,
(
  select aps.objectno,sum(aps.payinteamt) as payinteamt,aps.loanrate,min(aps.intedate) as intedate,sum(aps.paycorpusamt) as paycorpusamt from acct_payment_schedule aps 
  where 1=1 group by aps.loanrate,aps.objectno
) tzrhkjh,
(
  select accountbelong,accountno,userid 
  from (select emp.*,row_number() over(partition by emp.userid order by rownum) cn from 
  (
  select * from account_info ai where ai.status='2' 
  ) emp )
  where cn = 1 
) userinfo,
(
  select ua2.realname,al2.clearanceacctno  
  from acct_loan al2,user_account2 ua2 where 1=1 
  and al2.objecttype='01' 
  and al2.customerid=ua2.userid 
) jkr 
where 1=1 
and pi.loanapplyno=ba.serialno 
and ba.relativeserialno = la.applyno 
and pi.status not in ('0', '1', '2') 
and pi.serialno = tzr.clearanceacctno 
and tzr.userid = userinfo.userid(+) 
and tzr.projectid=pi.serialno 
and pi.serialno = jkr.clearanceacctno 
and pi.enddate is not null 
and tzrhkjh.objectno=tzr.serialno 
<#if xmbh?exists && xmbh=='ok'> and 1=2 </#if>
<#if xmbh?exists && xmbh!=''> and pi.serialno='${xmbh}' </#if> 
<#if toubaoperson?exists && toubaoperson!=''> and jkr.realname='${toubaoperson}' </#if> 
<#if begandate?exists && begandate!=''> and substr(pi.enddate,1,10) >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and substr(pi.enddate,1,10) <= '${enddate}' </#if> 
<#if proname?exists && proname!=''> and pi.projectname like '%${proname}%' </#if>
		 ]]>
	</select>
	<select id="queryhaigujiaouserinfoexcel" class="map">
	     <![CDATA[
select distinct ua.realname,
case when (ua.certtype is null) then null else (select cl.itemname from CODE_LIBRARY cl where cl.codeno='CertType' and cl.itemno=ua.certtype) end as certtype,
ua.certid,
ua.phonetel,
case when imt.insurancetype='0' then '05' when imt.insurancetype='1' then '04' when imt.insurancetype='2' then '03' when imt.insurancetype='3' then '02' when imt.insurancetype='4' then '01' else '' end insurancetype 
from project_info pi,business_approve ba,loan_apply la,invest_record ir,user_contract uc,user_account2 ua left join insurance_manage_test imt on imt.userid=ua.userid 
where 1=1 
and pi.loanapplyno=ba.serialno 
and ba.relativeserialno = la.applyno 
and pi.status not in ('0', '1', '2') 
and uc.projectid=pi.serialno 
and ua.userid=ir.userid 
and ir.userid=uc.userid 
and ir.rebillno=uc.contractid 
and ir.subcontractno = uc.subcontractno 
and la.hgjproductid is not null 
<#if hgjproductid?exists && hgjproductid!=''> and la.hgjproductid = '${hgjproductid}' </#if> 

		 ]]>
	</select>
	<select id="queryhaigujiaouserinfocount" class="map">
	     <![CDATA[
select count(1) num
from project_info pi,business_approve ba,loan_apply la,invest_record ir,user_contract uc,user_account2 ua left join insurance_manage_test imt on imt.userid=ua.userid 
where 1=1 
and pi.loanapplyno=ba.serialno 
and ba.relativeserialno = la.applyno 
and pi.status not in ('0', '1', '2') 
and uc.projectid=pi.serialno 
and ua.userid=ir.userid 
and ir.userid=uc.userid 
and ir.rebillno=uc.contractid 
and ir.subcontractno = uc.subcontractno 
and la.hgjproductid is not null 
<#if hgjproductid?exists && hgjproductid!=''> and la.hgjproductid = '${hgjproductid}' </#if> 
		 ]]>
	</select>
	<select id="queryhaigujiaorengouexcel" class="map">
	     <![CDATA[
select la.hgjproductid,
case when (userinfo.certtype is null) then null else (select cl.itemname from CODE_LIBRARY cl where cl.codeno='CertType' and cl.itemno=userinfo.certtype) end as certtype,
userinfo.certid,
userinvest.amount,
userinvest.transtime,
'1010' as channelflag 
from project_info pi, 
( 
  select uc.projectid,ir.userid,ir.usageplatform,sum(ir.amount) as amount,min(ir.inputtime) as transtime 
  from invest_record ir,user_contract uc where 1=1 
  and ir.userid=uc.userid 
  and ir.rebillno=uc.contractid 
  group by uc.projectid,ir.userid,ir.usageplatform 
) userinvest, 
(
  select ua.userid,ua.certtype,ua.certid from user_account ua  
) userinfo,
business_approve ba,loan_apply la 
where 1=1 
and pi.loanapplyno=ba.serialno 
and ba.relativeserialno = la.applyno 
and pi.status not in ('0', '1', '2') 
and userinvest.projectid=pi.serialno 
and userinfo.userid=userinvest.userid 
and la.hgjproductid is not null 
<#if begandate?exists && begandate!=''> and substr(pi.enddate,1,10) >= '${begandate}' </#if>
<#if enddate?exists && enddate!=''> and substr(pi.enddate,1,10) <= '${enddate}' </#if> 
order by userinvest.transtime desc
		 ]]>
	</select>				
	<select id="queryhaigujiaorengoucount" class="map">
	     <![CDATA[
select count(1) as num
from project_info pi, 
( 
  select uc.projectid,ir.userid,ir.usageplatform,sum(ir.amount) as amount,min(ir.inputtime) as transtime 
  from invest_record ir,user_contract uc where 1=1 
  and ir.userid=uc.userid 
  and ir.rebillno=uc.contractid 
  group by uc.projectid,ir.userid,ir.usageplatform 
) userinvest, 
(
  select ua.userid,ua.certtype,ua.certid from user_account ua  
) userinfo,
business_approve ba,loan_apply la 
where 1=1 
and pi.loanapplyno=ba.serialno 
and ba.relativeserialno = la.applyno 
and pi.status not in ('0', '1', '2') 
and userinvest.projectid=pi.serialno 
and userinfo.userid=userinvest.userid 
and la.hgjproductid is not null 
<#if begandate?exists && begandate!=''> and substr(pi.enddate,1,10) >= '${begandate}' </#if>
<#if enddate?exists && enddate!=''> and substr(pi.enddate,1,10) <= '${enddate}' </#if> 
order by userinvest.transtime desc
		 ]]>
	</select>				
	<select id="querybrhludancostexcel" class="map">
	     <![CDATA[
select  SERIALNO, PROJECTNAME , CUSTOMERNAME , OCCURDATE,
 TERMMONTH, XSTERM, BUSINESSSUM, INPUTNAME, CSENDTIME, ZSENDTIME ,BEGINDATE
 from LUDAN_FEIYONG where 1=1 
<#if begandate?exists && begandate!=''> and OCCURDATE >= '${begandate}' </#if>
<#if enddate?exists && enddate!=''> and OCCURDATE <= '${enddate}' </#if> 

		 ]]>
	</select>				
	<select id="brhldrenyuancostlistexcel" class="map">
	     <![CDATA[
select 
ui.username, 
ui.certid, 
bcr.bfb_acct, 
count(infouser.inputuserid) as innum, 
count(infouser.inputuserid)*20 as yfamount  
from 
(
  SELECT 
  (
    select inputstage.USERID from 
    (
      select xsft1.OBJECTNO,xsft1.USERID, row_number() over(partition by xsft1.OBJECTNO order by xsft1.endtime desc) as num 
      from XS_FLOW_TASK xsft1 where xsft1.FLOWNO = 'LoanApplyFlow' and xsft1.phaseno = '0010' 
    ) inputstage WHERE inputstage.num=1 and inputstage.OBJECTNO=xsba.SERIALNO
  ) as inputuserid 
  FROM XS_BUSINESS_APPLY xsba,XS_FLOW_TASK xsft,XS_FLOW_OPINION xsfp,XS_PROJECT_RELATIVE_ASSESTS XSPR ,XS_UNDERLY_ASSETS XSUA,project_info pi,business_approve ba,loan_apply la 
  WHERE 1=1 
  and xsba.SERIALNO = xsft.OBJECTNO 
  AND xsft.SERIALNO = xsfp.OPINIONNO 
  AND xsft.FLOWNO = 'LoanApplyFlow' 
  AND xsft.phaseno = '8040' 
  and xsfp.PHASECHOICE = '010' 
  and xsft.ENDTIME is not null 
  and XSBA.SERIALNO = XSUA.APPROVENO 
  and XSUA.ASSETNO =XSPR.OBJECTNO 
  and pi.loanapplyno=ba.serialno 
  and la.fundsource='XD' 
  and ba.relativeserialno=la.applyno 
  and la.xdprojectno=XSPR.PROJECTNO 
  and pi.begindate is not null 
  <#if begandate?exists && begandate!=''> and substr(xsba.OCCURDATE,1,10) >= '${begandate}' </#if>
  <#if enddate?exists && enddate!=''> and substr(xsba.OCCURDATE,1,10) <= '${enddate}' </#if>

) infouser,xs_user_info ui,bfb_certid_relation bcr  
where 1=1 
and infouser.inputuserid(+)=ui.userid 
and ui.certid=bcr.certid(+) 
group by ui.username,ui.certid,bcr.bfb_acct 
		 ]]>
	</select>				
	
	<select id="brhinvestsuccessexcel" class="map">
	     <![CDATA[
select distinct
jkr.realname, 
abd.productdes, 
to_char(sum(pi.LOANAMOUNT-pi.remainamount) over(partition by jkr.realname),'9999999990.99') as dealamount, 
to_char(sum(jkr.PLAFORMAMT) over(partition by jkr.realname),'9999999990.99') as PLAFORMAMTSUM, 
to_char((sum(pi.LOANAMOUNT-pi.remainamount) over(partition by jkr.realname) -sum(jkr.PLAFORMAMT) over(partition by jkr.realname)),'9999999990.99') as fkamount,
to_char(sum(jkrhkjh.paycorpusamt+jkrhkjh.payinteamt) over(partition by jkr.realname),'9999999990.99') as ljhkamount, 
pi.projectname as projectname, 
jkr.PUTOUTDATE, 
jkrhkjh.intedate, 
(to_date(jkr.MATURITYDATE,'YYYY/MM/DD')-to_date(jkrhkjh.intedate,'YYYY/MM/DD')) as loanperiod, 
jkr.LOANRATE, 
(jkr.LOANRATE+afli.feerate) rzcb, 
to_char(jkr.PLAFORMAMT,'9999999990.99') as PLAFORMAMT, 
jkr.MATURITYDATE, 
to_char((jkrhkjh.paycorpusamt+jkrhkjh.payinteamt),'9999999990.99') as hkamount 
from project_info pi,business_approve ba,loan_apply la,acct_business_define abd,acct_fee_loan_info afli,
(
  select ua.realname,al.clearanceacctno,al.PLAFORMAMT,al.serialno,al.PUTOUTDATE,al.LOANRATE,al.MATURITYDATE 
  from acct_loan al,user_account ua where 1=1 
  and al.objecttype='01' 
  and al.customerid=ua.userid 
) jkr,  
(
  select aps.objectno,sum(aps.payinteamt) as payinteamt,aps.loanrate,min(aps.intedate) as intedate,sum(aps.paycorpusamt) as paycorpusamt from acct_payment_schedule aps 
  where 1=1 group by aps.loanrate,aps.objectno 
) jkrhkjh  
where 1=1 
and pi.loanapplyno=ba.serialno 
and ba.relativeserialno = la.applyno 
and pi.status not in ('0', '1', '2') 
and pi.serialno = jkr.clearanceacctno 
and ba.businesstype=abd.typeno 
and jkrhkjh.objectno=jkr.serialno 
and afli.loanserialno=jkr.serialno 
and afli.feecode='010'
 <#if investproject?exists && investproject=='kobe'> and 1=2 </#if> 
 <#if investproject?exists && investproject!=''> and abd.productdes like '%${investproject}%' </#if> 
 <#if investname?exists && investname!=''> and jkr.realname = '${investname}' </#if> 
 <#if begandate?exists && begandate!=''> and jkr.PUTOUTDATE >= '${begandate}' </#if> 
 <#if enddate?exists && enddate!=''> and jkr.PUTOUTDATE <= '${enddate}' </#if> 
order by pi.projectname
		 ]]>
	</select>			
	<select id="brhludanpersoncount" class="map">
	     <![CDATA[
select  
count(infouser.inputuserid) as innum, 
count(infouser.inputuserid)*20 as yfamount  
from 
(
  SELECT 
  (
    select inputstage.USERID from 
    (
      select xsft1.OBJECTNO,xsft1.USERID, row_number() over(partition by xsft1.OBJECTNO order by xsft1.endtime desc) as num 
      from XS_FLOW_TASK xsft1 where xsft1.FLOWNO = 'LoanApplyFlow' and xsft1.phaseno = '0010' 
    ) inputstage WHERE inputstage.num=1 and inputstage.OBJECTNO=xsba.SERIALNO
  ) as inputuserid 
  FROM XS_BUSINESS_APPLY xsba,XS_FLOW_TASK xsft,XS_FLOW_OPINION xsfp,XS_PROJECT_RELATIVE_ASSESTS XSPR ,XS_UNDERLY_ASSETS XSUA,project_info pi,business_approve ba,loan_apply la 
  WHERE 1=1 
  and xsba.SERIALNO = xsft.OBJECTNO 
  AND xsft.SERIALNO = xsfp.OPINIONNO 
  AND xsft.FLOWNO = 'LoanApplyFlow' 
  AND xsft.phaseno = '8040' 
  and xsfp.PHASECHOICE = '010' 
  and xsft.ENDTIME is not null 
  and XSBA.SERIALNO = XSUA.APPROVENO 
  and XSUA.ASSETNO =XSPR.OBJECTNO 
  and pi.loanapplyno=ba.serialno 
  and la.fundsource='XD' 
  and ba.relativeserialno=la.applyno 
  and la.xdprojectno=XSPR.PROJECTNO 
  and pi.begindate is not null 
  <#if begandate?exists && begandate!=''> and substr(xsba.OCCURDATE,1,10) >= '${begandate}' </#if>
  <#if enddate?exists && enddate!=''> and substr(xsba.OCCURDATE,1,10) <= '${enddate}' </#if>

) infouser,xs_user_info ui,bfb_certid_relation bcr  
where 1=1 
and infouser.inputuserid(+)=ui.userid 
and ui.certid=bcr.certid(+) 
		 ]]>
	</select>			
<select id="brhinvestcountexcel" class="map">
	     <![CDATA[
select
count(*) as num
from project_info pi,business_approve ba,loan_apply la,acct_business_define abd,acct_fee_loan_info afli,
(
  select ua.realname,al.clearanceacctno,al.PLAFORMAMT,al.serialno,al.PUTOUTDATE,al.LOANRATE,al.MATURITYDATE 
  from acct_loan al,user_account ua where 1=1 
  and al.objecttype='01' 
  and al.customerid=ua.userid 
) jkr,  
(
  select aps.objectno,sum(aps.payinteamt) as payinteamt,aps.loanrate,min(aps.intedate) as intedate,sum(aps.paycorpusamt) as paycorpusamt from acct_payment_schedule aps 
  where 1=1 group by aps.loanrate,aps.objectno 
) jkrhkjh  
where 1=1 
and pi.loanapplyno=ba.serialno 
and ba.relativeserialno = la.applyno 
and pi.status not in ('0', '1', '2') 
and pi.serialno = jkr.clearanceacctno 
and ba.businesstype=abd.typeno 
and jkrhkjh.objectno=jkr.serialno 
and afli.loanserialno=jkr.serialno 
and afli.feecode='010'
 <#if investproject?exists && investproject=='kobe'> and 1=2 </#if> 
 <#if investproject?exists && investproject!=''> and abd.productdes like '%${investproject}%' </#if> 
 <#if investname?exists && investname!=''> and jkr.realname = '${investname}' </#if> 
 <#if begandate?exists && begandate!=''> and jkr.PUTOUTDATE >= '${begandate}' </#if> 
 <#if enddate?exists && enddate!=''> and jkr.PUTOUTDATE <= '${enddate}' </#if>  
		 ]]>
	</select>	
	<select id="queryfirstinvestexcel" class="map">
	     <![CDATA[
select substr(a.time,0,10) as time,(select subitemname from sub_code_library where subitemno=(case when o.channel='APP_WECHAT_SUB#rd' then 'APP_WECHAT_SUB' when o.channel is null then 'BRH_WEB' else o.channel end)) as channel,count(1) as num,sum(ir.amount) as amount from invest_record ir,  
(select i.userid,min(i.inputtime) time from invest_record i group by i.userid having 1=1 
<#if begandate?exists && begandate!=''> and substr(min(i.inputtime),0,10)  >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and substr(min(i.inputtime),0,10)  <= '${enddate}' </#if>
)a,operation_record o 
  where ir.userid=a.userid and ir.inputtime=a.time 
 and ir.relativeuioserialno=o.indexid 
 and o.handletype = '2' group by substr(a.time,0,10),o.channel order by substr(a.time,0,10),o.channel
		 ]]>
	</select>
	<select id="queryfirstregistexcel" class="map">
	     <![CDATA[
select substr(o.inputtime,0,10) as time,
(select subitemname from sub_code_library where subitemno=(case when o.channel='APP_WECHAT_SUB#rd' then 'APP_WECHAT_SUB' when o.channel is null then 'BRH_WEB' else o.channel end)) as channel,count(1) as num from operation_record o where o.handletype = '1' 
<#if begandate?exists && begandate!=''> and substr(o.inputtime,0,10) >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and substr(o.inputtime,0,10) <= '${enddate}' </#if>
group by substr(o.inputtime,0,10),o.channel order by substr(o.inputtime,0,10),o.channel
		 ]]>
	</select>
	<select id="queryregionsexcount1" class="map">
	     <![CDATA[
 select investtotal.investtotalnum,investnan.investnannum,investnv.investnvnum,age1830.age1830num,age3140.age3140num,age4150.age4150num,age5160.age5160num,age6170.age6170num,age71.age71num
from 
(
SELECT count(distinct userid) as investtotalnum FROM REGION_AGE_COUNT  where 1=1
 <#if begandate?exists && begandate!=''> and  begantime >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and  begantime <= '${enddate}' </#if> 
) investtotal,
(
  SELECT count(distinct userid) as investnannum FROM REGION_AGE_COUNT
  where sex = 1
<#if begandate?exists && begandate!=''> and  begantime >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and  begantime <= '${enddate}' </#if>  
)investnan,
(
  SELECT count(distinct userid) as investnvnum FROM REGION_AGE_COUNT
where sex = 0
 <#if begandate?exists && begandate!=''> and  begantime >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and  begantime <= '${enddate}' </#if> 
)investnv,
(
  SELECT count(distinct userid) as age1830num FROM REGION_AGE_COUNT where 1=1
 and age >= 18
  and age <= 30
<#if begandate?exists && begandate!=''> and  begantime >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and  begantime <= '${enddate}' </#if> 
)age1830,
(
  SELECT count(distinct userid) as age3140num FROM REGION_AGE_COUNT where 1=1
  and age >= 31
  and age <= 40
<#if begandate?exists && begandate!=''> and  begantime >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and  begantime <= '${enddate}' </#if> 
)age3140,
(
  SELECT count(distinct userid) as age4150num FROM REGION_AGE_COUNT where 1=1
and age >= 41
  and age <= 50
 <#if begandate?exists && begandate!=''> and  begantime >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and  begantime <= '${enddate}' </#if> 
)age4150,
(
  SELECT count(distinct userid) as age5160num FROM REGION_AGE_COUNT where 1=1
  and age >= 51
  and age <= 60
 <#if begandate?exists && begandate!=''> and  begantime >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and  begantime <= '${enddate}' </#if> 
)age5160,
(
  SELECT count(distinct userid) as age6170num FROM REGION_AGE_COUNT where 1=1
 and age >= 61
  and age <= 70
 <#if begandate?exists && begandate!=''> and  begantime >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and  begantime <= '${enddate}' </#if>  
)age6170,
(
  SELECT count(distinct userid) as age71num FROM REGION_AGE_COUNT where 1=1
and age >= 71
   <#if begandate?exists && begandate!=''> and  begantime >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and  begantime <= '${enddate}' </#if> 
)age71    
		 ]]>
	</select>
	<select id="queryregionsexcount2" class="map">
	     <![CDATA[
 select beijing.beinum ,tianjin.tiannum,shanghai.shanghainum,chognqing.chognqingnum,guangdong.guangdongnum
,guangxi.guangxinum,jiangsu.jiangsunum,zhejiang.zhejiangnum,fujian.fujiannum,hebei.hebeinum,henan.henannum
,shandong.shandongnum,shanxi.shanxinum,shanxisheng.sxnum,gansu.gansunum
from
(
SELECT count(distinct userid) as beinum FROM REGION_AGE_COUNT where 1=1
 and shengfen = '11'
<#if begandate?exists && begandate!=''> and  begantime >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and  begantime <= '${enddate}' </#if> 
) beijing,
(
SELECT count(distinct userid) as tiannum FROM REGION_AGE_COUNT where 1=1
and shengfen = '12' 
<#if begandate?exists && begandate!=''> and  begantime >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and  begantime <= '${enddate}' </#if> 
) tianjin,
(
SELECT count(distinct userid) as shanghainum FROM REGION_AGE_COUNT where 1=1
and shengfen = '31' 
<#if begandate?exists && begandate!=''> and  begantime >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and  begantime <= '${enddate}' </#if> 
) shanghai,
(
SELECT count(distinct userid) as chognqingnum FROM REGION_AGE_COUNT where 1=1
and shengfen = '50'
<#if begandate?exists && begandate!=''> and  begantime >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and  begantime <= '${enddate}' </#if>  
) chognqing,
(
SELECT count(distinct userid) as guangdongnum FROM REGION_AGE_COUNT where 1=1
and shengfen = '44' 
<#if begandate?exists && begandate!=''> and  begantime >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and  begantime <= '${enddate}' </#if> 
) guangdong,
(
SELECT count(distinct userid) as guangxinum FROM REGION_AGE_COUNT where 1=1
and shengfen = '45'
<#if begandate?exists && begandate!=''> and  begantime >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and  begantime <= '${enddate}' </#if>  
) guangxi,
(
SELECT count(distinct userid) as jiangsunum FROM REGION_AGE_COUNT where 1=1
and shengfen = '32' 
<#if begandate?exists && begandate!=''> and  begantime >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and  begantime <= '${enddate}' </#if> 
) jiangsu,
(
SELECT count(distinct userid) as zhejiangnum FROM REGION_AGE_COUNT where 1=1
and shengfen = '33' 
<#if begandate?exists && begandate!=''> and  begantime >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and  begantime <= '${enddate}' </#if> 
) zhejiang,
(
SELECT count(distinct userid) as fujiannum FROM REGION_AGE_COUNT where 1=1
and shengfen = '35' 
<#if begandate?exists && begandate!=''> and  begantime >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and  begantime <= '${enddate}' </#if> 
) fujian,
(
SELECT count(distinct userid) as hebeinum FROM REGION_AGE_COUNT where 1=1
and shengfen = '13' 
<#if begandate?exists && begandate!=''> and  begantime >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and  begantime <= '${enddate}' </#if> 
) hebei,
(
SELECT count(distinct userid) as henannum FROM REGION_AGE_COUNT where 1=1
 and shengfen = '41' 
<#if begandate?exists && begandate!=''> and  begantime >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and  begantime <= '${enddate}' </#if> 

) henan,
(
SELECT count(distinct userid) as shandongnum FROM REGION_AGE_COUNT where 1=1
 and shengfen = '37' 
<#if begandate?exists && begandate!=''> and  begantime >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and  begantime <= '${enddate}' </#if> 

) shandong,
(
SELECT count(distinct userid) as shanxinum FROM REGION_AGE_COUNT where 1=1
 and shengfen = '14' 
<#if begandate?exists && begandate!=''> and  begantime >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and  begantime <= '${enddate}' </#if> 

) shanxi,
(
SELECT count(distinct userid) as sxnum FROM REGION_AGE_COUNT where 1=1
and shengfen = '61' 
<#if begandate?exists && begandate!=''> and  begantime >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and  begantime <= '${enddate}' </#if> 
) shanxisheng,
(
SELECT count(distinct userid) as gansunum FROM REGION_AGE_COUNT where 1=1
 and shengfen = '62' 
<#if begandate?exists && begandate!=''> and  begantime >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and  begantime <= '${enddate}' </#if> 

) gansu 
		 ]]>
	</select>
	<select id="queryregionsexcount3" class="map">
	     <![CDATA[
  select qinghai.qinghainum,xizang.xizangnum,xinjiang.xinjiangnum,liaoning.liaoningnum,heilongjiang.heilongjiangnum,jilin.jilinnum
,ningxia.ningxianum,neimenggu.neimenggunum,sichuan.sichuannum,hunan.hunannum,hubei.hubeinum,jiangxi.jiangxinum,anhui.anhuinum
,hainan.hainannum,yunnan.yunnannum,guizhou.guizhounum,othershengshi.othernum
from
(
SELECT count(distinct userid) as qinghainum FROM  REGION_AGE_COUNT
 where 1=1
and shengfen = '63' 
<#if begandate?exists && begandate!=''> and  begantime >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and  begantime <= '${enddate}' </#if> 
) qinghai,
(
SELECT count(distinct userid) as xizangnum FROM REGION_AGE_COUNT
 where 1=1
 
and shengfen = '54'
<#if begandate?exists && begandate!=''> and  begantime >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and  begantime <= '${enddate}' </#if>  
) xizang,
(
SELECT count(distinct userid) as xinjiangnum FROM REGION_AGE_COUNT
 where 1=1
and shengfen = '65'
<#if begandate?exists && begandate!=''> and  begantime >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and  begantime <= '${enddate}' </#if>  
) xinjiang,
(
SELECT count(distinct userid) as liaoningnum FROM REGION_AGE_COUNT
 where 1=1
and shengfen = '21' 
<#if begandate?exists && begandate!=''> and  begantime >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and  begantime <= '${enddate}' </#if> 
) liaoning,
(
SELECT count(distinct userid) as heilongjiangnum FROM REGION_AGE_COUNT
 where 1=1
 
and shengfen = '23' 
<#if begandate?exists && begandate!=''> and  begantime >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and  begantime <= '${enddate}' </#if> 
) heilongjiang,
(
SELECT count(distinct userid) as jilinnum FROM REGION_AGE_COUNT
 where 1=1
and shengfen = '22' 
<#if begandate?exists && begandate!=''> and  begantime >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and  begantime <= '${enddate}' </#if> 
) jilin,
(
SELECT count(distinct userid) as ningxianum FROM REGION_AGE_COUNT
 where 1=1
and shengfen = '64'
<#if begandate?exists && begandate!=''> and  begantime >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and  begantime <= '${enddate}' </#if>  
) ningxia,
(
SELECT count(distinct userid) as neimenggunum FROM REGION_AGE_COUNT
 where 1=1
and shengfen = '15' 
<#if begandate?exists && begandate!=''> and  begantime >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and  begantime <= '${enddate}' </#if> 
) neimenggu,
(
SELECT count(distinct userid) as sichuannum FROM REGION_AGE_COUNT
 where 1=1
and shengfen = '51'
<#if begandate?exists && begandate!=''> and  begantime >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and  begantime <= '${enddate}' </#if>  
) sichuan,
(
SELECT count(distinct userid) as hunannum FROM REGION_AGE_COUNT
 where 1=1
and shengfen = '43'
<#if begandate?exists && begandate!=''> and  begantime >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and  begantime <= '${enddate}' </#if>  
) hunan,
(
SELECT count(distinct userid) as hubeinum FROM REGION_AGE_COUNT
 where 1=1
and shengfen = '42' 
<#if begandate?exists && begandate!=''> and  begantime >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and  begantime <= '${enddate}' </#if> 
) hubei,
(
SELECT count(distinct userid) as jiangxinum FROM REGION_AGE_COUNT
 where 1=1
and shengfen = '36'
<#if begandate?exists && begandate!=''> and  begantime >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and  begantime <= '${enddate}' </#if>  
) jiangxi,
(
SELECT count(distinct userid) as anhuinum FROM REGION_AGE_COUNT
 where 1=1
and shengfen = '34' 
<#if begandate?exists && begandate!=''> and  begantime >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and  begantime <= '${enddate}' </#if> 
) anhui,
(
SELECT count(distinct userid) as hainannum FROM REGION_AGE_COUNT
 where 1=1
and shengfen = '46'
<#if begandate?exists && begandate!=''> and  begantime >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and  begantime <= '${enddate}' </#if>  
) hainan,
(
SELECT count(distinct userid) as yunnannum FROM REGION_AGE_COUNT
 where 1=1
and shengfen = '53'
<#if begandate?exists && begandate!=''> and  begantime >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and  begantime <= '${enddate}' </#if>  
) yunnan,
(
SELECT count(distinct userid) as guizhounum FROM REGION_AGE_COUNT
 where 1=1
and shengfen = '52'
<#if begandate?exists && begandate!=''> and  begantime >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and  begantime <= '${enddate}' </#if>  
) guizhou,
(
SELECT count(distinct userid) as othernum FROM REGION_AGE_COUNT 
 where 1=1
and shengfen not in ('11','12','31','50','44','45','32','33','35','13','41','37','14','61','62','63','54','65','21','23','22','64','15','51','43','42','36','34','46','53','52')
<#if begandate?exists && begandate!=''> and  begantime >= '${begandate}' </#if> 
<#if enddate?exists && enddate!=''> and  begantime <= '${enddate}' </#if> 
) othershengshi
 
		 ]]>
	</select>
<select id="queryprojiekuanshenhe" class="map">
	     <![CDATA[
select  
xsba.SERIALNO,
(select substr(productdes,0,4) from acct_business_define where typeno=ba.businesstype) as producttype, 
pi.projectname,
ua.realname,
ua.certid,
(pi.LOANAMOUNT-pi.remainamount) as dealamount,
(to_date(al.MATURITYDATE,'YYYY/MM/DD')-to_date(jkrhkjh.intedate,'YYYY/MM/DD')) as loanperiod,
jkrhkjh.intedate,
al.MATURITYDATE,
(select itemname from code_library cl where cl.codeno='ProjectStatus' and cl.itemno=pi.status) as projectstatus,
al.finishdate,
(
select contractrow.GUARANTORNAME from 
(
select GUARANTORNAME,APPLICATIONNO,rownum as indexnum from XS_GUARANTY_CONTRACT  
) contractrow where 1=1 and APPLICATIONNO=xsba.serialno
and contractrow.indexnum=1
) as danbaoren1,
(
select contractrow.GUARANTORNAME from 
(
select GUARANTORNAME,APPLICATIONNO,rownum as indexnum from XS_GUARANTY_CONTRACT
) contractrow where 1=1 and APPLICATIONNO=xsba.serialno
and contractrow.indexnum=2
) as danbaoren2,
(
select contractrow.GUARANTORNAME from 
(
select GUARANTORNAME,APPLICATIONNO,rownum as indexnum from XS_GUARANTY_CONTRACT 
) contractrow where 1=1 and APPLICATIONNO=xsba.serialno
and contractrow.indexnum=3
) as danbaoren3,
(
  select inputstage.USERNAME from 
  (
    select xsft1.OBJECTNO,xsft1.USERNAME, row_number() over(partition by xsft1.OBJECTNO order by xsft1.endtime desc) as num 
    from XS_FLOW_TASK xsft1 where xsft1.FLOWNO = 'LoanApplyFlow' and xsft1.phaseno = '8030' 
  ) inputstage WHERE inputstage.num=1 and inputstage.OBJECTNO=xsba.SERIALNO
) as csusername,
xsft.USERNAME as zsusername,
XSOI.orgname 
FROM XS_BUSINESS_APPLY xsba,XS_FLOW_TASK xsft,XS_FLOW_OPINION xsfp,XS_PROJECT_RELATIVE_ASSESTS XSPR ,XS_UNDERLY_ASSETS XSUA,XS_ORG_INFO XSOI,project_info pi,business_approve ba,loan_apply la,acct_loan al,user_account ua,  

(
  select aps.objectno,aps.loanrate,min(aps.intedate) as intedate from acct_payment_schedule aps 
  where 1=1 group by aps.loanrate,aps.objectno 
) jkrhkjh  
WHERE 1=1 
and xsba.SERIALNO = xsft.OBJECTNO 
AND xsft.SERIALNO = xsfp.OPINIONNO 
AND xsft.FLOWNO = 'LoanApplyFlow' 
AND xsft.phaseno = '8040' 
and xsfp.PHASECHOICE = '010' 
and xsft.ENDTIME is not null 
and XSBA.SERIALNO = XSUA.APPROVENO 
and XSUA.ASSETNO =XSPR.OBJECTNO 
and XSBA.BUSINESSORG = XSOI.ORGID
and pi.loanapplyno=ba.serialno 
and la.fundsource='XD' 
and ba.relativeserialno=la.applyno 
and la.xdprojectno=XSPR.PROJECTNO 
and pi.serialno = al.clearanceacctno 
and jkrhkjh.objectno=al.serialno 
and al.objecttype='01' 
and al.customerid=ua.userid
<#if begandate?exists && begandate!=''> and jkrhkjh.intedate >= '${begandate}' </#if>
<#if enddate?exists && enddate!=''> and jkrhkjh.intedate <= '${enddate}' </#if>
	
 ]]>
	</select>							
</sql>
	